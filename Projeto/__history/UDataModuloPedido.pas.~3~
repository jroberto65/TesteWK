unit UDataModuloPedido;

interface

uses
  System.SysUtils, System.Classes, FireDAC.Stan.Intf, FireDAC.Stan.Option,
  FireDAC.Stan.Param, FireDAC.Stan.Error, FireDAC.DatS, FireDAC.Phys.Intf,
  FireDAC.DApt.Intf, FireDAC.Stan.Async, FireDAC.DApt, FireDAC.Comp.Client,
  Data.DB, FireDAC.Comp.DataSet, UPedidosModel;

type
  TDataModuloPedido = class(TDataModule)
    fdQryInserirPedido: TFDQuery;
    fdTransInserir: TFDTransaction;
  private
    { Private declarations }
  public
    { Public declarations }
    function InserirPedido(pPedido: TPedidos; out pErro: string): Boolean;
  end;

var
  DataModuloPedido: TDataModuloPedido;

implementation

{%CLASSGROUP 'Vcl.Controls.TControl'}

{$R *.dfm}

{ TDataModuloPedido }

function TDataModuloPedido.InserirPedido(pPedido: TPedidos;
  out pErro: string): Boolean;
begin
  with fdQryInserirPedido, pPedido do
  begin
    ParamByName('Numero').Value := Numero;
    ParamByName('EmitidoEm').Value := EmitidoEm;
    ParamByName('CodigoCliente').Value := CodigoCliente;
    ParamByName('ValorTotal').Value := ValorTotal;
    try
      Transaction.StartTransaction;
      ExecSQL();
      Transaction.Commit;
      Result := True
    except on E: Exception do
      begin
        Transaction.Rollback;
        pErro := 'Erro ao tentar inserir o pedido: ' + sLineBreak +  e.Message;
        Result := False;
      end;
    end;
  end;
end;

end.
